import java.text.DateFormat
import java.text.SimpleDateFormat

class Version {
	String longV
	String shortV

	def String toString() {
		longV
	}
}

def getGitHash() {
	def stdout = new ByteArrayOutputStream()
	exec {
		commandLine 'git', 'rev-parse', '--short', 'HEAD'
		standardOutput = stdout
	}
	return stdout.toString().trim()
}

def getGitBranch() {
	def stdout = new ByteArrayOutputStream()
	exec {
		commandLine 'git', 'symbolic-ref', '--short', 'HEAD'
		standardOutput = stdout
	}
	return stdout.toString().trim()
}

def Version getRevision() {
	String currentDate = new SimpleDateFormat("yyyy_MM_dd_HH_mm_ss").format(new Date());
	String shortBuf = getGitBranch() + "-" + currentDate;
	String longBuf = "Build date-" + currentDate + " Branch name-" + getGitBranch() + " CommitHash-" + getGitHash();
	return new Version ( longV: longBuf, shortV: shortBuf)
}

ext {
	revision = getRevision()
}